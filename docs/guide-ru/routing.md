Маршрутизация
=============

Реализовав классы ресурсов и контроллеров, можно получить доступ к ресурсам, используя URL вроде
`http://localhost/index.php?r=user/create`, подобно тому, как это происходит в обычных web-приложениях.

Но на деле обычно хочется включить «красивые» URL-адреса и использовать все преимущества HTTP-методов.
Например, чтобы запрос `POST /users` вызывал обращение к действию `user/create`.
Это может быть легко сделано с помощью настройки [компонента приложения](structure-application-components.md)
`urlManager`, его нужно сконфигурировать следующим образом:

```php
'urlManager' => [
    'enablePrettyUrl' => true,
    'enableStrictParsing' => true,
    'showScriptName' => false,
    'rules' => [
        ['__class' => Yiisoft\Yii\Rest\UrlRule::class, 'controller' => 'user'],
    ],
]
```

Главное отличие в коде выше по сравнению с управлением URL-адресами в web-приложениях состоит в использовании
[[Yiisoft\Yii\Rest\UrlRule]] для маршрутизации запросов к RESTful API. Этот особый класс URL-правил будет создавать целый набор дочерних URL-правил для поддержки маршрутизации и создания URL-адресов для указанного контроллера (или контроллеров).
Например, приведенный выше код является приближенным аналогом следующего набора правил:

```php
[
    'PUT,PATCH users/<id>' => 'user/update',
    'DELETE users/<id>' => 'user/delete',
    'GET,HEAD users/<id>' => 'user/view',
    'POST users' => 'user/create',
    'GET,HEAD users' => 'user/index',
    'OPTIONS users/<id>' => 'user/options',
    'OPTIONS users' => 'user/options',
]
```

Этим правилом поддерживаются следующие точки входа в API:

* `GET /users`: разбитый на страницы список всех пользователей;
* `HEAD /users`: общая информация по списку пользователей;
* `POST /users`: создание нового пользователя;
* `GET /users/123`: подробная информация о пользователе 123;
* `HEAD /users/123`: общая информация о пользователе 123;
* `PATCH /users/123` и `PUT /users/123`: обновление пользователя 123;
* `DELETE /users/123`: удаление пользователя 123;
* `OPTIONS /users`: список HTTP-методов, поддерживаемые точкой входа `/users`;
* `OPTIONS /users/123`: список HTTP-методов, поддерживаемые точкой входа `/users/123`.

Вы можете настроить опции `only` и `except`, явно указав для них список действий, которые поддерживаются или
которые должны быть отключены, соответственно. Например:

```php
[
    '__class' => Yiisoft\Yii\Rest\UrlRule::class,
    'controller' => 'user',
    'except' => ['delete', 'create', 'update'],
],
```

Вы также можете настроить опции `patterns` или `extraPatterns` для переопределения существующих шаблонов или добавления новых шаблонов, поддерживаемых этим правилом. Например, для включения нового действия `search` в точке входа `GET /users/search` настройте опцию `extraPatterns` следующим образом:

```php
[
    '__class' => Yiisoft\Yii\Rest\UrlRule::class,
    'controller' => 'user',
    'extraPatterns' => [
        'GET search' => 'search',
    ],
]
```

Как вы могли заметить, ID контроллера `user` в этих точках входа используется в форме множественного числа (как `users`).
Это происходит потому, что [[Yiisoft\Yii\Rest\UrlRule]] автоматически приводит идентификаторы контроллеров к множественной форме.
Вы можете отключить такое поведение, назначив свойству [[Yiisoft\Yii\Rest\UrlRule::pluralize]] значение `false`.

> Info: Приведение ID контроллера к множественной форме производится в методе [[yii\helpers\Inflector::pluralize()]].
  При этом соблюдаются правила английского языка. Например, `box` будет преобразован в `boxes`, а не в `boxs`.

В том случае, если автоматическое приведение к множественному числу вам не подходит, вы можете настроить 
свойство [[Yiisoft\Yii\Rest\UrlRule::controller]], где указать явное соответствие имени в URL и ID контроллера.
Например, код ниже ставит в соответствие имя `u` и ID контроллера `user`.  

```php
[
    '__class' => Yiisoft\Yii\Rest\UrlRule::class,
    'controller' => ['u' => 'user'],
]
```
